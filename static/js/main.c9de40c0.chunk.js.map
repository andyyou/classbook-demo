{"version":3,"sources":["App.js","index.js"],"names":["PEN_COLORS","getRelativePointerPosition","node","transform","getAbsoluteTransform","copy","invert","pos","getStage","getPointerPosition","point","GlobalStyle","createGlobalStyle","Container","styled","div","ToolBox","ToolBoxInner","Paginator","IconButton","button","props","enable","css","TextButton","Box","CircleButton","active","color","BrushCursor","width","height","initialState","draggable","tool","pages","0","left","student","teacher","right","lines","1","2","3","4","5","6","7","8","leftVersion","rightVersion","pageNum","pageIndex","pageLayout","penBoxVisible","eraserBoxVisible","stroke","strokeWidth","stageScale","x","y","stagePosition","reducer","state","action","type","payload","scale","parseInt","App","stageElement","useRef","useReducer","dispatch","isDrawing","currentPage","useImage","leftPage","rightPage","handleSetTool","useEffect","n","index","length","Object","keys","handleChangeStroke","handleChangeStokeWidth","e","target","value","cursor","h","window","innerHeight","w","c","innerWidth","ref","onMouseMove","current","style","top","clientY","clientX","onMouseDown","points","onMousemove","lastLine","concat","splice","onMouseup","onWheel","evt","preventDefault","lastScale","scaleX","mousePointTo","newScale","deltaY","newPos","position","image","map","line","i","tension","lineCap","globalCompositeOperation","onClick","stopPropagation","textAlign","min","max","onChange","className","maxNum","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.c9de40c0.chunk.js","sourcesContent":["import {\n  useEffect,\n  useReducer,\n  useRef,\n} from 'react';\nimport styled, { createGlobalStyle, css } from 'styled-components';\n\nimport {\n  Stage,\n  Layer,\n  Image,\n  Line,\n} from 'react-konva';\nimport useImage from 'use-image';\nimport {\n  IconPencil,\n  IconEraser,\n  IconChevronUpLeft,\n  IconChevronUpRight,\n  IconChevronDownLeft,\n  IconChevronDownRight,\n  IconHandFinger,\n  IconRotateClockwise,\n  IconChevronLeft,\n  IconChevronRight,\n  IconCirclePlus,\n  IconCircleMinus,\n  IconMaximize,\n} from '@tabler/icons';\n\nconst ORIGIN_WIDHT = 1394;\nconst ORIGIN_HEIGHT = 1970;\nconst PEN_COLORS = [\n  'rgb(248, 36, 0)',\n  'rgb(243, 149, 0)',\n  'rgb(255, 255, 0)',\n  'rgb(110, 176, 0)',\n  'rgb(34, 147, 251)',\n  'rgb(255, 0, 255)',\n  'rgb(255, 114, 147)',\n  'rgb(0, 0, 0)',\n  'rgb(255, 255, 255)',\n  'rgb(128, 128, 128)',\n];\n\nfunction getRelativePointerPosition(node) {\n  const transform = node.getAbsoluteTransform().copy();\n  transform.invert();\n  const pos = node.getStage().getPointerPosition();\n  return transform.point(pos);\n}\n\nconst GlobalStyle = createGlobalStyle`\n  body {\n    margin: 0;\n  }\n`;\n\nconst Container = styled.div`\n  width: 100vw;\n  height: 100vh;\n  overflow: hidden;\n`;\n\nconst ToolBox = styled.div`\n  display: flex;\n  position: fixed;\n  top: 3px;\n  width: 100vw;\n  background-color: transparent;\n  justify-content: center;\n  margin-bottom: 8px;\n  font-size: 14px;\n  font-family: Inter, Arial;\n`;\n\nconst ToolBoxInner = styled.div`\n  background-color: rgba(0, 0, 0, 0.8);\n  border-radius: 4px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n`;\n\nconst Paginator = styled.div`\n  display: flex;\n  align-items: center;\n\n  .label {\n    color: white;\n  }\n`;\n\nconst IconButton = styled.button`\n  border: none;\n  width: 36px;\n  height: 36px;\n  display: inline-flex;\n  justify-content: center;\n  align-items: center;\n  background-color: transparent;\n  color: #999;\n  position: relative;\n  &:hover {\n    color: #ccc;\n  }\n\n  ${(props) => props.enable ? css`\n    color: #fff !important;\n  ` : css`\n    color: #999;\n  `}\n`;\n\nconst TextButton = styled.button`\n  margin: 0 5px;\n  height: 36px;\n  border: none;\n  display: inline-flex;\n  justify-content: center;\n  align-items: center;\n  background-color: transparent;\n  color: #fff;\n\n  &:hover {\n    color: #ccc;\n  }\n`;\n\nconst Box = styled.div`\n  position: absolute;\n  top: 40px;\n  left: 0;\n  width: 300px;\n  height: 180px;\n  border: 1px solid #ccc;\n  box-shadow: 2px 2px 6px #ccc;\n  border-radius: 8px;\n  background-color: white;\n  padding: 15px;\n  z-index: 5;\n  text-align: left;\n\n  label {\n    display: block;\n    color: black;\n    text-align: left;\n    margin: 5px 0;\n  }\n`;\n\nconst CircleButton = styled.button`\n  border: ${(props) => props.active ? '3px solid black' : '1px solid #ccc'};\n  border-radius: 50%;\n  width: 24px;\n  height: 24px;\n  background-color: ${(props) => props.color || '#ddd'};\n  margin: 0 3px;\n`;\n\nconst BrushCursor = styled.div`\n  pointer-events: none;\n  position: absolute;\n  width: ${(props) => `${props.width}px`};\n  height: ${(props) => `${props.height}px`};\n  border: 1px solid #999;\n  border-radius: 50%;\n  z-index: 999;\n`;\n\nconst initialState = {\n  draggable: false,\n  tool: 'pen',\n  pages: {\n    0: {\n      left: {\n        student: 'books/a3-s/0.jpeg',\n        teacher: 'books/a3-t/0.jpeg',\n      },\n      right: {\n        student: 'books/a3-s/1.jpeg',\n        teacher: 'books/a3-t/1.jpeg',\n      },\n      lines: [],\n    },\n    1: {\n      left: {\n        student: 'books/a3-s/2.jpeg',\n        teacher: 'books/a3-t/2.jpeg',\n      },\n      right: {\n        student: 'books/a3-s/3.jpeg',\n        teacher: 'books/a3-t/3.jpeg',\n      },\n      lines: [],\n    },\n    2: {\n      left: {\n        student: 'books/a3-s/4.jpeg',\n        teacher: 'books/a3-t/4.jpeg',\n      },\n      right: {\n        student: 'books/a3-s/5.jpeg',\n        teacher: 'books/a3-t/5.jpeg',\n      },\n      lines: [],\n    },\n    3: {\n      left: {\n        student: 'books/a3-s/6.jpeg',\n        teacher: 'books/a3-t/6.jpeg',\n      },\n      right: {\n        student: 'books/a3-s/7.jpeg',\n        teacher: 'books/a3-t/7.jpeg',\n      },\n      lines: [],\n    },\n    4: {\n      left: {\n        student: 'books/a3-s/8.jpeg',\n        teacher: 'books/a3-t/8.jpeg',\n      },\n      right: {\n        student: 'books/a3-s/9.jpeg',\n        teacher: 'books/a3-t/9.jpeg',\n      },\n      lines: [],\n    },\n    5: {\n      left: {\n        student: 'books/a3-s/10.jpeg',\n        teacher: 'books/a3-t/10.jpeg',\n      },\n      right: {\n        student: 'books/a3-s/11.jpeg',\n        teacher: 'books/a3-t/11.jpeg',\n      },\n      lines: [],\n    },\n    6: {\n      left: {\n        student: 'books/a3-s/12.jpeg',\n        teacher: 'books/a3-t/12.jpeg',\n      },\n      right: {\n        student: 'books/a3-s/13.jpeg',\n        teacher: 'books/a3-t/13.jpeg',\n      },\n      lines: [],\n    },\n    7: {\n      left: {\n        student: 'books/a3-s/14.jpeg',\n        teacher: 'books/a3-t/14.jpeg',\n      },\n      right: {\n        student: 'books/a3-s/15.jpeg',\n        teacher: 'books/a3-t/15.jpeg',\n      },\n      lines: [],\n    },\n    8: {\n      left: {\n        student: 'books/a3-s/16.jpeg',\n        teacher: 'books/a3-t/16.jpeg',\n      },\n      right: {\n        student: 'books/a3-s/17.jpeg',\n        teacher: 'books/a3-t/17.jpeg',\n      },\n      lines: [],\n    },\n  },\n  leftVersion: 'student',\n  rightVersion: 'student',\n  pageNum: 1,\n  pageIndex: 0,\n  pageLayout: {},\n  penBoxVisible: false,\n  eraserBoxVisible: false,\n  stroke: 'rgb(248, 36, 0)',\n  strokeWidth: 5,\n  stageScale: {\n    x: 1,\n    y: 1,\n  },\n  stagePosition: {\n    x: 0,\n    y: 0,\n  }\n};\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case 'SET_LINES': {\n      const {\n        pageIndex,\n        lines,\n      } = action.payload;\n      return {\n        ...state,\n        pages: {\n          ...state.pages,\n          [pageIndex]: {\n            ...state.pages[pageIndex],\n            lines,\n          }\n        },\n        penBoxVisible: false,\n        eraserBoxVisible: false,\n      };\n    }\n    case 'RESET_PAGE': {\n      const {\n        pageIndex,\n      } = action.payload;\n      return {\n        ...state,\n        pages: {\n          ...state.pages,\n          [pageIndex]: {\n            ...state.pages[pageIndex],\n            lines: [],\n          }\n        },\n        stageScale: {\n          x: 1,\n          y: 1,\n        },\n        stagePosition: {\n          x: 0,\n          y: 0,\n        },\n      };\n    }\n    case 'SET_PAGE_LAYOUT': {\n      return {\n        ...state,\n        pageLayout: { ...action.payload },\n      };\n    }\n    case 'SET_TOOL': {\n      const penBoxVisible = state.penBoxVisible ? !state.penBoxVisible : 'pen' === action.payload;\n      const eraserBoxVisible = state.eraserBoxVisible ? !state.eraserBoxVisible : 'eraser' === action.payload;\n      return {\n        ...state,\n        tool: action.payload,\n        draggable: false,\n        penBoxVisible,\n        eraserBoxVisible,\n      };\n    }\n    case 'RESET_STAGE_ZOOM': {\n      return {\n        ...state,\n        stageScale: {\n          x: 1,\n          y: 1,\n        },\n        stagePosition: {\n          x: 0,\n          y: 0,\n        },\n      };\n    }\n    case 'SET_STAGE_SCALE': {\n      return {\n        ...state,\n        stageScale: {\n          x: action.payload.x,\n          y: action.payload.y,\n        },\n      }\n    }\n    case 'SET_STAGE_POSITION': {\n      return {\n        ...state,\n        stagePosition: action.payload,\n      };\n    }\n    case 'SET_STAGE_ZOOM': {\n      return {\n        ...state,\n        stageScale: {\n          x: action.payload.scale,\n          y: action.payload.scale,\n        },\n        stagePosition: {\n          x: action.payload.x,\n          y: action.payload.y,\n        },\n      };\n    }\n    case 'TOGGLE_DRAGGABLE': {\n      return {\n        ...state,\n        draggable: !state.draggable,\n      };\n    }\n    case 'SET_PAGE_INDEX': {\n      return {\n        ...state,\n        pageIndex: parseInt(action.payload),\n      };\n    }\n    case 'SET_PAGE_NUM': {\n      return {\n        ...state,\n        pageNum: action.payload,\n      };\n    }\n    case 'TOGGLE_LEFT_VERSION': {\n      return {\n        ...state,\n        leftVersion: state.leftVersion === 'student' ? 'teacher' : 'student',\n      };\n    }\n    case 'TOGGLE_RIGHT_VERSION': {\n      return {\n        ...state,\n        rightVersion: state.rightVersion === 'student' ? 'teacher' : 'student',\n      };\n    }\n    case 'SET_STROKE': {\n      return {\n        ...state,\n        stroke: action.payload,\n      };\n    }\n    case 'SET_STROKE_WIDTH': {\n      return {\n        ...state,\n        strokeWidth: action.payload,\n      };\n    }\n    default: {\n      return state;\n    }\n  }\n};\n\nfunction App() {\n  const stageElement = useRef(null);\n  const [state, dispatch] = useReducer(reducer, initialState);\n  const isDrawing = useRef(false);\n  const {\n    draggable,\n    tool,\n    pages,\n    leftVersion,\n    rightVersion,\n    penBoxVisible,\n    eraserBoxVisible,\n    stroke,\n    strokeWidth,\n    pageNum,\n    pageIndex,\n    pageLayout,\n    stageScale,\n    stagePosition,\n  } = state;\n\n  const currentPage = pages[pageIndex];\n  const [leftPage] = useImage(currentPage.left[leftVersion]);\n  const [rightPage] = useImage(currentPage.right[rightVersion]);\n\n  const handleDrawStart = (e) => {\n    if (draggable) {\n      return;\n    }\n    isDrawing.current = true;\n    const point = getRelativePointerPosition(e.target.getStage());\n    dispatch({\n      type: 'SET_LINES',\n      payload: {\n        pageIndex,\n        lines: [\n          ...currentPage.lines,\n          {\n            tool,\n            points: [point.x, point.y],\n            stroke,\n            strokeWidth,\n          },\n        ],\n      },\n    });\n  };\n\n  const handleDrawMove = (e) => {\n    if (!isDrawing.current) {\n      return;\n    }\n\n    const stage = e.target.getStage();\n    const point = getRelativePointerPosition(stage);\n    let lastLine = currentPage.lines[currentPage.lines.length - 1];\n    lastLine.points = lastLine.points.concat([point.x, point.y]);\n\n    currentPage.lines.splice(currentPage.lines.length - 1, 1, lastLine);\n    dispatch({\n      type: 'SET_LINES',\n      payload: {\n        pageIndex,\n        lines: [\n          ...currentPage.lines.concat(),\n        ],\n      },\n    });\n  };\n\n  const handleDrawEnd = () => {\n    isDrawing.current = false;\n  };\n\n  const handleWheel = (e) => {\n    e.evt.preventDefault();\n    const scaleBy = 1.3;\n    const lastScale = stageElement.current.scaleX();\n    const mousePointTo = {\n      x: stageElement.current.getPointerPosition().x / lastScale - stageElement.current.x() / lastScale,\n      y: stageElement.current.getPointerPosition().y / lastScale - stageElement.current.y() / lastScale\n    };\n\n    const newScale = e.evt.deltaY > 0 ? lastScale * scaleBy : lastScale / scaleBy;\n    dispatch({\n      type: 'SET_STAGE_SCALE',\n      payload: { x: newScale, y: newScale },\n    });\n    // stageElement.current.scale({ x: newScale, y: newScale });\n\n    let newPos = {\n      x: -(mousePointTo.x - stageElement.current.getPointerPosition().x / newScale) * newScale,\n      y: -(mousePointTo.y - stageElement.current.getPointerPosition().y / newScale) * newScale,\n    };\n    dispatch({\n      type: 'SET_STAGE_POSITION',\n      payload: newPos,\n    });\n    // stageElement.current.position(newPos);\n    // stageElement.current.batchDraw();\n  };\n\n  const handleSetTool = (tool) => () => {\n    dispatch({\n      type: 'SET_TOOL',\n      payload: tool,\n    });\n  };\n\n  const handleToggleDraggable = () => {\n    dispatch({\n      type: 'TOGGLE_DRAGGABLE',\n    })\n  };\n\n  const handleResetZoom = () => {\n    dispatch({\n      type: 'RESET_STAGE_ZOOM',\n    });\n  };\n\n  const handleUpLeftZoom = () => {\n    const scale = 2;\n    const x = -(pageLayout.left.x * scale) + pageLayout.left.x;\n    const y = 0;\n    dispatch({\n      type: 'SET_STAGE_ZOOM',\n      payload: {\n        scale,\n        x,\n        y,\n      },\n    });\n  };\n  const handleUpRightZoom = () => {\n    const scale = 2;\n    const x = -(pageLayout.right.x * scale) + pageLayout.left.x;\n    const y = 0;\n    dispatch({\n      type: 'SET_STAGE_ZOOM',\n      payload: {\n        scale,\n        x,\n        y,\n      },\n    });\n  };\n\n  const handleDownLeftZoom = () => {\n    const scale = 2;\n    const x = -(pageLayout.left.x * scale) + pageLayout.left.x;\n    const y = -(pageLayout.left.height / 2) * scale;\n    dispatch({\n      type: 'SET_STAGE_ZOOM',\n      payload: {\n        scale,\n        x,\n        y,\n      },\n    });\n  };\n\n  const handleDownRightZoom = () => {\n    const scale = 2;\n    const x = -(pageLayout.right.x * scale) + pageLayout.left.x;\n    const y = -(pageLayout.right.height / 2) * scale;\n    dispatch({\n      type: 'SET_STAGE_ZOOM',\n      payload: {\n        scale,\n        x,\n        y,\n      },\n    });\n  };\n\n  const handleZoomIn = () => {\n    const newScale = stageScale.x * 1.05;\n    dispatch({\n      type: 'SET_STAGE_SCALE',\n      payload: { x: newScale, y: newScale },\n    });\n  };\n\n  const handleZoomOut = () => {\n    const newScale = stageScale.x / 1.05;\n    dispatch({\n      type: 'SET_STAGE_SCALE',\n      payload: { x: newScale, y: newScale },\n    });\n  };\n\n  const handlePrevPage = () => {\n    const n = parseInt(pageNum);\n    const newPageNum = n - 1 > 1 ? n - 1 : 1;\n    dispatch({\n      type: 'SET_PAGE_NUM',\n      payload: newPageNum,\n    });\n  };\n\n  const handleNextPage = () => {\n    const length = Object.keys(pages).length;\n    const maxNum = pages[length - 1].right ? length * 2 : length * 2 - 1;\n    const n = parseInt(pageNum);\n    const newPageNum = n + 1 < maxNum ? n + 1 : maxNum;\n    dispatch({\n      type: 'SET_PAGE_NUM',\n      payload: newPageNum,\n    });\n  };\n\n  const handleInputChange = (e) => {\n    dispatch({\n      type: 'SET_PAGE_NUM',\n      payload: e.target.value,\n    });\n  };\n\n  useEffect(() => {\n    if (parseInt(pageNum) > 0) {\n      const n = parseInt(pageNum);\n      let index = parseInt(n / 2);\n      index = n % 2 === 0 ? index - 1 : index;\n      const length = Object.keys(pages).length;\n      if (index >= length) {\n        index = length - 1;\n      } else if (index < 0) {\n        index = 0;\n      }\n      dispatch({\n        type: 'SET_PAGE_INDEX',\n        payload: index,\n      });\n    }\n  }, [pageNum]);\n\n  const handleToggleLeftVersion = () => {\n    dispatch({\n      type: 'TOGGLE_LEFT_VERSION',\n    });\n  };\n\n  const handleToggleRightVersion = () => {\n    dispatch({\n      type: 'TOGGLE_RIGHT_VERSION',\n    });\n  };\n\n  const handleChangeStroke = (color) => () => {\n    dispatch({\n      type: 'SET_STROKE',\n      payload: color,\n    });\n  };\n\n  const handleChangeStokeWidth = (e) => {\n    dispatch({\n      type: 'SET_STROKE_WIDTH',\n      payload: e.target.value,\n    });\n  };\n\n  const handleResetPage = () => {\n    dispatch({\n      type: 'RESET_PAGE',\n      payload: {\n        pageIndex,\n      },\n    })\n  };\n\n  const cursor = useRef(null);\n  const handleBrushMove = (e) => {\n    if (!draggable && cursor.current) {\n      cursor.current.style.top = `${e.clientY - strokeWidth / 2}px`;\n      cursor.current.style.left = `${e.clientX - strokeWidth / 2}px`;\n    }\n  };\n\n  useEffect(() => {\n    const h = window.innerHeight - 60;\n    const s = h / ORIGIN_HEIGHT;\n    const w = ORIGIN_WIDHT * s;\n    const c = window.innerWidth / 2;\n    const leftX = c - w;\n    const rightX = c;\n    dispatch({\n      type: 'SET_PAGE_LAYOUT',\n      payload: {\n        left: {\n          x: leftX,\n          y: 60,\n          width: w,\n          height: h,\n        },\n        right: {\n          x: rightX,\n          y: 60,\n          width: w,\n          height: h,\n        },\n      },\n    });\n  }, []);\n\n  return (\n    <>\n      <GlobalStyle />\n      {!draggable && (\n        <BrushCursor\n          ref={cursor}\n          width={strokeWidth}\n          height={strokeWidth}\n        />\n      )}\n\n      <Container onMouseMove={handleBrushMove}>\n        {/* {version === 'teacher' && (\n          <Badge>\n          教師版\n        </Badge>\n        )} */}\n\n        <Stage\n          ref={stageElement}\n          draggable={draggable}\n          width={window.innerWidth}\n          height={window.innerHeight}\n          onMouseDown={handleDrawStart}\n          onMousemove={handleDrawMove}\n          onMouseup={handleDrawEnd}\n          onWheel={handleWheel}\n          scale={stageScale}\n          position={stagePosition}\n        >\n          <Layer>\n            {pageLayout.left && (\n              <Image image={leftPage}\n                width={pageLayout.left.width}\n                height={pageLayout.left.height}\n                x={pageLayout.left.x}\n                y={pageLayout.left.y}\n              />\n            )}\n            {pageLayout.right && (\n              <Image image={rightPage}\n                width={pageLayout.right.width}\n                height={pageLayout.right.height}\n                x={pageLayout.right.x}\n                y={pageLayout.right.y}\n              />\n            )}\n          </Layer>\n          <Layer>\n            {currentPage.lines.map((line, i) => (\n              <Line\n                key={i}\n                points={line.points}\n                stroke={line.stroke}\n                strokeWidth={line.strokeWidth}\n                tension={0.5}\n                lineCap=\"round\"\n                globalCompositeOperation={\n                  line.tool === 'eraser' ? 'destination-out' : 'source-over'\n                }\n              />\n            ))}\n          </Layer>\n        </Stage>\n\n        <ToolBox>\n          <ToolBoxInner>\n            <IconButton\n              type=\"button\"\n              onClick={handleToggleDraggable}\n              enable={draggable}\n            >\n              <IconHandFinger />\n            </IconButton>\n            <IconButton\n              type=\"button\"\n              onClick={handleSetTool('pen')}\n              enable={!draggable && tool === 'pen'}\n            >\n              <IconPencil />\n              {penBoxVisible && (\n                <Box onClick={(e) => e.stopPropagation()}>\n                  <label>顏色</label>\n                  {PEN_COLORS.map((color, i) => (\n                    <CircleButton\n                      color={color}\n                      active={stroke === color}\n                      key={`color-${i}`}\n                      onClick={handleChangeStroke(color)}\n                    >\n                    </CircleButton>\n                  ))}\n                  <div style={{ textAlign: 'left'}}>\n                    <label>尺寸</label>\n                    <input\n                      type=\"range\"\n                      min=\"5\"\n                      max=\"30\"\n                      value={strokeWidth}\n                      onChange={handleChangeStokeWidth}\n                    />\n                  </div>\n                </Box>\n              )}\n            </IconButton>\n\n            <IconButton\n              type=\"button\"\n              onClick={handleSetTool('eraser')}\n              enable={!draggable && tool === 'eraser'}\n            >\n              <IconEraser />\n              {eraserBoxVisible && (\n                <Box onClick={(e) => e.stopPropagation()}>\n                  <div style={{ textAlign: 'left'}}>\n                    <label>尺寸</label>\n                    <input\n                      type=\"range\"\n                      min=\"5\"\n                      max=\"30\"\n                      value={strokeWidth}\n                      onChange={handleChangeStokeWidth}\n                    />\n                  </div>\n                </Box>\n              )}\n            </IconButton>\n\n            <IconButton type=\"button\" onClick={handleUpLeftZoom} enable>\n              <IconChevronUpLeft />\n            </IconButton>\n            <IconButton type=\"button\" onClick={handleUpRightZoom} enable>\n              <IconChevronUpRight />\n            </IconButton>\n            <IconButton type=\"button\" onClick={handleDownLeftZoom} enable>\n              <IconChevronDownLeft />\n            </IconButton>\n            <IconButton type=\"button\" onClick={handleDownRightZoom} enable>\n              <IconChevronDownRight />\n            </IconButton>\n            <IconButton type=\"button\" onClick={handleResetZoom} enable>\n              <IconMaximize />\n            </IconButton>\n            <IconButton type=\"button\" onClick={handleResetPage} enable>\n              <IconRotateClockwise />\n            </IconButton>\n            <IconButton type=\"button\" onClick={handleZoomIn} enable>\n              <IconCirclePlus />\n            </IconButton>\n            <IconButton type=\"button\" onClick={handleZoomOut} enable>\n              <IconCircleMinus />\n            </IconButton>\n            <Paginator>\n              <div className=\"label\">頁數 </div>\n              <IconButton type=\"button\" onClick={handlePrevPage} enable>\n                <IconChevronLeft />\n              </IconButton>\n              <input\n                type=\"text\"\n                style={{\n                  width: 40,\n                  textAlign: 'center',\n                }}\n                value={pageNum}\n                onChange={handleInputChange}\n              />\n              <IconButton type=\"button\" onClick={handleNextPage} enable>\n                <IconChevronRight />\n              </IconButton>\n            </Paginator>\n            <TextButton\n              type=\"button\"\n              onClick={handleToggleLeftVersion}\n            >\n              {leftVersion === 'student' ? '顯示左頁解答' : '關閉左頁解答'}\n            </TextButton>\n            <TextButton\n              type=\"button\"\n              onClick={handleToggleRightVersion}\n            >\n              {rightVersion === 'student' ? '顯示右頁解答' : '關閉右頁解答'}\n            </TextButton>\n          </ToolBoxInner>\n        </ToolBox>\n      </Container>\n    </>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport App from './App';\n// import reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\n// reportWebVitals();\n"],"sourceRoot":""}