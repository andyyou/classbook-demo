(this.webpackJsonppdfbook=this.webpackJsonppdfbook||[]).push([[0],{36:function(e,t,n){"use strict";n.r(t);var a,o,c,r,i,s,l,b,p,j,d,g,u=n(0),O=n.n(u),x=n(22),h=n.n(x),y=n(13),f=n(11),E=n(4),k=n(3),S=n(6),T=n(7),_=n(9),v=n(19),G=n.n(v),A=n(5),w=n(2),I=["rgb(248, 36, 0)","rgb(243, 149, 0)","rgb(255, 255, 0)","rgb(110, 176, 0)","rgb(34, 147, 251)","rgb(255, 0, 255)","rgb(255, 114, 147)","rgb(0, 0, 0)","rgb(255, 255, 255)","rgb(128, 128, 128)"];function m(e){var t=e.getAbsoluteTransform().copy();t.invert();var n=e.getStage().getPointerPosition();return t.point(n)}var P=Object(T.a)(a||(a=Object(S.a)(["\n  body {\n    margin: 0;\n  }\n"]))),C=T.c.div(o||(o=Object(S.a)(["\n  width: 100vw;\n  height: 100vh;\n  overflow: hidden;\n"]))),L=T.c.div(c||(c=Object(S.a)(["\n  display: flex;\n  position: fixed;\n  top: 3px;\n  width: 100vw;\n  background-color: transparent;\n  justify-content: center;\n  margin-bottom: 8px;\n  font-size: 14px;\n  font-family: Inter, Arial;\n"]))),V=T.c.div(r||(r=Object(S.a)(["\n  background-color: rgba(0, 0, 0, 0.8);\n  border-radius: 4px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n"]))),R=T.c.div(i||(i=Object(S.a)(["\n  display: flex;\n  align-items: center;\n\n  .label {\n    color: white;\n  }\n"]))),N=T.c.button(s||(s=Object(S.a)(["\n  border: none;\n  width: 36px;\n  height: 36px;\n  display: inline-flex;\n  justify-content: center;\n  align-items: center;\n  background-color: transparent;\n  color: #999;\n  position: relative;\n  &:hover {\n    color: #ccc;\n  }\n\n  ","\n"])),(function(e){return e.enable?Object(T.b)(l||(l=Object(S.a)(["\n    color: #fff !important;\n  "]))):Object(T.b)(b||(b=Object(S.a)(["\n    color: #999;\n  "])))})),M=T.c.button(p||(p=Object(S.a)(["\n  margin: 0 5px;\n  height: 36px;\n  border: none;\n  display: inline-flex;\n  justify-content: center;\n  align-items: center;\n  background-color: transparent;\n  color: #fff;\n\n  &:hover {\n    color: #ccc;\n  }\n"]))),B=T.c.div(j||(j=Object(S.a)(["\n  position: absolute;\n  top: 40px;\n  left: 0;\n  width: 300px;\n  height: 180px;\n  border: 1px solid #ccc;\n  box-shadow: 2px 2px 6px #ccc;\n  border-radius: 8px;\n  background-color: white;\n  padding: 15px;\n  z-index: 5;\n  text-align: left;\n\n  label {\n    display: block;\n    color: black;\n    text-align: left;\n    margin: 5px 0;\n  }\n"]))),W=T.c.button(d||(d=Object(S.a)(["\n  border: ",";\n  border-radius: 50%;\n  width: 24px;\n  height: 24px;\n  background-color: ",";\n  margin: 0 3px;\n"])),(function(e){return e.active?"3px solid black":"1px solid #ccc"}),(function(e){return e.color||"#ddd"})),D=T.c.div(g||(g=Object(S.a)(["\n  pointer-events: none;\n  position: absolute;\n  width: ",";\n  height: ",";\n  border: 1px solid #999;\n  border-radius: 50%;\n  z-index: 999;\n"])),(function(e){return"".concat(e.width,"px")}),(function(e){return"".concat(e.height,"px")})),Z={draggable:!1,tool:"pen",pages:{0:{left:{student:"./books/a3-s/0.jpeg",teacher:"./books/a3-t/0.jpeg"},right:{student:"books/a3-s/1.jpeg",teacher:"books/a3-t/1.jpeg"},lines:[]},1:{left:{student:"books/a3-s/2.jpeg",teacher:"books/a3-t/2.jpeg"},right:{student:"books/a3-s/3.jpeg",teacher:"books/a3-t/3.jpeg"},lines:[]},2:{left:{student:"books/a3-s/4.jpeg",teacher:"books/a3-t/4.jpeg"},right:{student:"books/a3-s/5.jpeg",teacher:"books/a3-t/5.jpeg"},lines:[]},3:{left:{student:"books/a3-s/6.jpeg",teacher:"books/a3-t/6.jpeg"},right:{student:"books/a3-s/7.jpeg",teacher:"books/a3-t/7.jpeg"},lines:[]},4:{left:{student:"books/a3-s/8.jpeg",teacher:"books/a3-t/8.jpeg"},right:{student:"books/a3-s/9.jpeg",teacher:"books/a3-t/9.jpeg"},lines:[]},5:{left:{student:"books/a3-s/10.jpeg",teacher:"books/a3-t/10.jpeg"},right:{student:"books/a3-s/11.jpeg",teacher:"books/a3-t/11.jpeg"},lines:[]},6:{left:{student:"books/a3-s/12.jpeg",teacher:"books/a3-t/12.jpeg"},right:{student:"books/a3-s/13.jpeg",teacher:"books/a3-t/13.jpeg"},lines:[]},7:{left:{student:"books/a3-s/14.jpeg",teacher:"books/a3-t/14.jpeg"},right:{student:"books/a3-s/15.jpeg",teacher:"books/a3-t/15.jpeg"},lines:[]},8:{left:{student:"books/a3-s/16.jpeg",teacher:"books/a3-t/16.jpeg"},right:{student:"books/a3-s/17.jpeg",teacher:"books/a3-t/17.jpeg"},lines:[]}},leftVersion:"student",rightVersion:"student",pageNum:1,pageIndex:0,pageLayout:{},penBoxVisible:!1,eraserBoxVisible:!1,stroke:"rgb(248, 36, 0)",strokeWidth:5,stageScale:{x:1,y:1},stagePosition:{x:0,y:0}},H=function(e,t){switch(t.type){case"SET_LINES":var n=t.payload,a=n.pageIndex,o=n.lines;return Object(k.a)(Object(k.a)({},e),{},{pages:Object(k.a)(Object(k.a)({},e.pages),{},Object(E.a)({},a,Object(k.a)(Object(k.a)({},e.pages[a]),{},{lines:o}))),penBoxVisible:!1,eraserBoxVisible:!1});case"RESET_PAGE":var c=t.payload.pageIndex;return Object(k.a)(Object(k.a)({},e),{},{pages:Object(k.a)(Object(k.a)({},e.pages),{},Object(E.a)({},c,Object(k.a)(Object(k.a)({},e.pages[c]),{},{lines:[]}))),stageScale:{x:1,y:1},stagePosition:{x:0,y:0}});case"SET_PAGE_LAYOUT":return Object(k.a)(Object(k.a)({},e),{},{pageLayout:Object(k.a)({},t.payload)});case"SET_TOOL":var r=e.penBoxVisible?!e.penBoxVisible:"pen"===t.payload,i=e.eraserBoxVisible?!e.eraserBoxVisible:"eraser"===t.payload;return Object(k.a)(Object(k.a)({},e),{},{tool:t.payload,draggable:!1,penBoxVisible:r,eraserBoxVisible:i});case"RESET_STAGE_ZOOM":return Object(k.a)(Object(k.a)({},e),{},{stageScale:{x:1,y:1},stagePosition:{x:0,y:0}});case"SET_STAGE_SCALE":return Object(k.a)(Object(k.a)({},e),{},{stageScale:{x:t.payload.x,y:t.payload.y}});case"SET_STAGE_POSITION":return Object(k.a)(Object(k.a)({},e),{},{stagePosition:t.payload});case"SET_STAGE_ZOOM":return Object(k.a)(Object(k.a)({},e),{},{stageScale:{x:t.payload.scale,y:t.payload.scale},stagePosition:{x:t.payload.x,y:t.payload.y}});case"TOGGLE_DRAGGABLE":return Object(k.a)(Object(k.a)({},e),{},{draggable:!e.draggable});case"SET_PAGE_INDEX":return Object(k.a)(Object(k.a)({},e),{},{pageIndex:parseInt(t.payload)});case"SET_PAGE_NUM":return Object(k.a)(Object(k.a)({},e),{},{pageNum:t.payload});case"TOGGLE_LEFT_VERSION":return Object(k.a)(Object(k.a)({},e),{},{leftVersion:"student"===e.leftVersion?"teacher":"student"});case"TOGGLE_RIGHT_VERSION":return Object(k.a)(Object(k.a)({},e),{},{rightVersion:"student"===e.rightVersion?"teacher":"student"});case"SET_STROKE":return Object(k.a)(Object(k.a)({},e),{},{stroke:t.payload});case"SET_STROKE_WIDTH":return Object(k.a)(Object(k.a)({},e),{},{strokeWidth:t.payload});default:return e}};var U=function(){var e=Object(u.useRef)(null),t=Object(u.useReducer)(H,Z),n=Object(f.a)(t,2),a=n[0],o=n[1],c=Object(u.useRef)(!1),r=a.draggable,i=a.tool,s=a.pages,l=a.leftVersion,b=a.rightVersion,p=a.penBoxVisible,j=a.eraserBoxVisible,d=a.stroke,g=a.strokeWidth,O=a.pageNum,x=a.pageIndex,h=a.pageLayout,E=a.stageScale,k=a.stagePosition,S=s[x],T=G()(S.left[l]),v=Object(f.a)(T,1)[0],U=G()(S.right[b]),K=Object(f.a)(U,1)[0],X=function(e){return function(){o({type:"SET_TOOL",payload:e})}};Object(u.useEffect)((function(){if(parseInt(O)>0){var e=parseInt(O),t=parseInt(e/2);t=e%2===0?t-1:t;var n=Object.keys(s).length;t>=n?t=n-1:t<0&&(t=0),o({type:"SET_PAGE_INDEX",payload:t})}}),[O]);var Y=function(e){return function(){o({type:"SET_STROKE",payload:e})}},z=function(e){o({type:"SET_STROKE_WIDTH",payload:e.target.value})},F=Object(u.useRef)(null);return Object(u.useEffect)((function(){var e=window.innerHeight-60,t=1394*(e/1970),n=window.innerWidth/2;o({type:"SET_PAGE_LAYOUT",payload:{left:{x:n-t,y:60,width:t,height:e},right:{x:n,y:60,width:t,height:e}}})}),[]),Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(P,{}),!r&&Object(w.jsx)(D,{ref:F,width:g,height:g}),Object(w.jsxs)(C,{onMouseMove:function(e){!r&&F.current&&(F.current.style.top="".concat(e.clientY-g/2,"px"),F.current.style.left="".concat(e.clientX-g/2,"px"))},children:[Object(w.jsxs)(_.d,{ref:e,draggable:r,width:window.innerWidth,height:window.innerHeight,onMouseDown:function(e){if(!r){c.current=!0;var t=m(e.target.getStage());o({type:"SET_LINES",payload:{pageIndex:x,lines:[].concat(Object(y.a)(S.lines),[{tool:i,points:[t.x,t.y],stroke:d,strokeWidth:g}])}})}},onMousemove:function(e){if(c.current){var t=m(e.target.getStage()),n=S.lines[S.lines.length-1];n.points=n.points.concat([t.x,t.y]),S.lines.splice(S.lines.length-1,1,n),o({type:"SET_LINES",payload:{pageIndex:x,lines:Object(y.a)(S.lines.concat())}})}},onMouseup:function(){c.current=!1},onWheel:function(t){t.evt.preventDefault();var n=e.current.scaleX(),a=e.current.getPointerPosition().x/n-e.current.x()/n,c=e.current.getPointerPosition().y/n-e.current.y()/n,r=t.evt.deltaY>0?1.3*n:n/1.3;o({type:"SET_STAGE_SCALE",payload:{x:r,y:r}});var i={x:-(a-e.current.getPointerPosition().x/r)*r,y:-(c-e.current.getPointerPosition().y/r)*r};o({type:"SET_STAGE_POSITION",payload:i})},scale:E,position:k,children:[Object(w.jsxs)(_.b,{children:[h.left&&Object(w.jsx)(_.a,{image:v,width:h.left.width,height:h.left.height,x:h.left.x,y:h.left.y}),h.right&&Object(w.jsx)(_.a,{image:K,width:h.right.width,height:h.right.height,x:h.right.x,y:h.right.y})]}),Object(w.jsx)(_.b,{children:S.lines.map((function(e,t){return Object(w.jsx)(_.c,{points:e.points,stroke:e.stroke,strokeWidth:e.strokeWidth,tension:.5,lineCap:"round",globalCompositeOperation:"eraser"===e.tool?"destination-out":"source-over"},t)}))})]}),Object(w.jsx)(L,{children:Object(w.jsxs)(V,{children:[Object(w.jsx)(N,{type:"button",onClick:function(){o({type:"TOGGLE_DRAGGABLE"})},enable:r,children:Object(w.jsx)(A.j,{})}),Object(w.jsxs)(N,{type:"button",onClick:X("pen"),enable:!r&&"pen"===i,children:[Object(w.jsx)(A.l,{}),p&&Object(w.jsxs)(B,{onClick:function(e){return e.stopPropagation()},children:[Object(w.jsx)("label",{children:"\u984f\u8272"}),I.map((function(e,t){return Object(w.jsx)(W,{color:e,active:d===e,onClick:Y(e)},"color-".concat(t))})),Object(w.jsxs)("div",{style:{textAlign:"left"},children:[Object(w.jsx)("label",{children:"\u5c3a\u5bf8"}),Object(w.jsx)("input",{type:"range",min:"5",max:"30",value:g,onChange:z})]})]})]}),Object(w.jsxs)(N,{type:"button",onClick:X("eraser"),enable:!r&&"eraser"===i,children:[Object(w.jsx)(A.i,{}),j&&Object(w.jsx)(B,{onClick:function(e){return e.stopPropagation()},children:Object(w.jsxs)("div",{style:{textAlign:"left"},children:[Object(w.jsx)("label",{children:"\u5c3a\u5bf8"}),Object(w.jsx)("input",{type:"range",min:"5",max:"30",value:g,onChange:z})]})})]}),Object(w.jsx)(N,{type:"button",onClick:function(){var e=-2*h.left.x+h.left.x;o({type:"SET_STAGE_ZOOM",payload:{scale:2,x:e,y:0}})},enable:!0,children:Object(w.jsx)(A.e,{})}),Object(w.jsx)(N,{type:"button",onClick:function(){var e=-2*h.right.x+h.left.x;o({type:"SET_STAGE_ZOOM",payload:{scale:2,x:e,y:0}})},enable:!0,children:Object(w.jsx)(A.f,{})}),Object(w.jsx)(N,{type:"button",onClick:function(){var e=-2*h.left.x+h.left.x,t=-h.left.height/2*2;o({type:"SET_STAGE_ZOOM",payload:{scale:2,x:e,y:t}})},enable:!0,children:Object(w.jsx)(A.a,{})}),Object(w.jsx)(N,{type:"button",onClick:function(){var e=-2*h.right.x+h.left.x,t=-h.right.height/2*2;o({type:"SET_STAGE_ZOOM",payload:{scale:2,x:e,y:t}})},enable:!0,children:Object(w.jsx)(A.b,{})}),Object(w.jsx)(N,{type:"button",onClick:function(){o({type:"RESET_STAGE_ZOOM"})},enable:!0,children:Object(w.jsx)(A.k,{})}),Object(w.jsx)(N,{type:"button",onClick:function(){o({type:"RESET_PAGE",payload:{pageIndex:x}})},enable:!0,children:Object(w.jsx)(A.m,{})}),Object(w.jsx)(N,{type:"button",onClick:function(){var e=1.05*E.x;o({type:"SET_STAGE_SCALE",payload:{x:e,y:e}})},enable:!0,children:Object(w.jsx)(A.h,{})}),Object(w.jsx)(N,{type:"button",onClick:function(){var e=E.x/1.05;o({type:"SET_STAGE_SCALE",payload:{x:e,y:e}})},enable:!0,children:Object(w.jsx)(A.g,{})}),Object(w.jsxs)(R,{children:[Object(w.jsx)("div",{className:"label",children:"\u9801\u6578 "}),Object(w.jsx)(N,{type:"button",onClick:function(){var e=parseInt(O);o({type:"SET_PAGE_NUM",payload:e-1>1?e-1:1})},enable:!0,children:Object(w.jsx)(A.c,{})}),Object(w.jsx)("input",{type:"text",style:{width:40,textAlign:"center"},value:O,onChange:function(e){o({type:"SET_PAGE_NUM",payload:e.target.value})}}),Object(w.jsx)(N,{type:"button",onClick:function(){var e=Object.keys(s).length,t=s[e-1].right?2*e:2*e-1,n=parseInt(O);o({type:"SET_PAGE_NUM",payload:n+1<t?n+1:t})},enable:!0,children:Object(w.jsx)(A.d,{})})]}),Object(w.jsx)(M,{type:"button",onClick:function(){o({type:"TOGGLE_LEFT_VERSION"})},children:"student"===l?"\u986f\u793a\u5de6\u9801\u89e3\u7b54":"\u95dc\u9589\u5de6\u9801\u89e3\u7b54"}),Object(w.jsx)(M,{type:"button",onClick:function(){o({type:"TOGGLE_RIGHT_VERSION"})},children:"student"===b?"\u986f\u793a\u53f3\u9801\u89e3\u7b54":"\u95dc\u9589\u53f3\u9801\u89e3\u7b54"})]})})]})]})};h.a.render(Object(w.jsx)(O.a.StrictMode,{children:Object(w.jsx)(U,{})}),document.getElementById("root"))}},[[36,1,2]]]);
//# sourceMappingURL=main.d3d30470.chunk.js.map